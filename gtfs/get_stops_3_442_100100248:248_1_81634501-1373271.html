<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
		<meta http-equiv="Content-Script-Type" content="text/javascript" />
		<meta http-equiv="Content-Style-Type" content="text/css" />
		<title>Interface GTFS</title>
		<link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.2/dist/leaflet.css" />
		<script src="https://unpkg.com/leaflet@1.0.2/dist/leaflet.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-polylinedecorator/1.1.0/leaflet.polylineDecorator.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-ajax/2.1.0/leaflet.ajax.min.js"></script>
	</head>
<body>
<p><a href="type_of_pt.html">Home</a>
 - <a href="get_agency_3.html">Bus</a>
 - <a href="get_routes_3_442.html">442</a>
 - <a href="get_trips_3_442_100100248:248_1.html">100100248:248 1</a>
 81634501-1373271
</p>
<p><button onclick="get_itin()">Itinéraire</button></p>
<p id="load_josm"></p>
<table id="osm"><tr>
<th><a href="http://localhost:8111/load_data?new_layer=false&data=%3C%3Fxml%20version%3D%271.0%27%20encoding%3D%27UTF-8%27%3F%3E%0A%3Cosm%20version%3D%220.6%22%20upload%3D%22false%22%3E%0A%3Crelation%20id%3D%22-1%22%3E%0A%3Ctag%20k%3D%22type%22%20v%3D%22route%22%2F%3E%0A%3Ctag%20k%3D%22route%22%20v%3D%22bus%22%2F%3E%0A%3Ctag%20k%3D%22public_transport%3Aversion%22%20v%3D%222%22%2F%3E%0A%3Ctag%20k%3D%22name%22%20v%3D%22Bus%20248%20%3A%20Drancy%20RER%20%E2%86%92%20Fort%20d%27Aubervilliers-Metro%22%2F%3E%0A%3Ctag%20k%3D%22from%22%20v%3D%22Drancy%20RER%22%2F%3E%0A%3Ctag%20k%3D%22to%22%20v%3D%22Fort%20d%27Aubervilliers-Metro%22%2F%3E%0A%3Ctag%20k%3D%22ref%22%20v%3D%22248%22%2F%3E%0A%3Ctag%20k%3D%22network%22%20v%3D%22RATP%22%2F%3E%0A%3Ctag%20k%3D%22colour%22%20v%3D%22%23C5A3CA%22%2F%3E%0A%3C%2Frelation%3E%0A%3C%2Fosm%3E%0A" target="hide">Créer la relation route dans JOSM</a> (attention aux doublons)
</th></tr>
<tr><td>name:Bus 248 : Drancy RER → Fort d'Aubervilliers-Metro</td></tr>
<tr><td>from:Drancy RER</td></tr>
<tr><td>to:Fort d'Aubervilliers-Metro</td></tr>
<tr><td>network:RATP</td></tr>
<tr><td>ref:248</td></tr>
<tr><td>colour:#C5A3CA</td></tr>
</table>
<iframe name="hide" style="display: None;"></iframe>
<div>
<div style="width: 640px; float: left;">
<table id="stops" class="main">
<tr><th>name</th><th>OSM?</th><th>ajout</th><th>?</th></tr>

<tr>
<td style="background-color:#FF0000";>Drancy RER</td>
<td style="background-color:#4FFF00";>148/346/N42 (node similaire à 0%) - distance 32 m
</td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.455084&right=2.455684&top=48.93312&bottom=48.93252&addtags=highway=bus_stop%7Cpublic_transport=platform%7Cname=Drancy RER&select=node2874216661" target="hide">compléter arrêt</a></td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.455084&right=2.455684&top=48.93312&bottom=48.93252" onclick="map.fitBounds([[48.93252,2.455084],[48.93312,2.455684]]);" target="hide">zoom JOSM</a></td>
</tr>
<tr>
<td style="background-color:#FF0000";>Place Joffre</td>
<td style="background-color:#28FF00";> (node similaire à 0%) - distance 17 m
</td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.455803&right=2.456403&top=48.931043&bottom=48.930443&addtags=highway=bus_stop%7Cpublic_transport=platform%7Cname=Place Joffre&select=node2452312634" target="hide">compléter arrêt</a></td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.455803&right=2.456403&top=48.931043&bottom=48.930443" onclick="map.fitBounds([[48.930443,2.455803],[48.931043,2.456403]]);" target="hide">zoom JOSM</a></td>
</tr>
<tr>
<td style="background-color:#FF0000";>Stade Charles Sage</td>
<td style="background-color:#8DFF00";> (node similaire à 0%) - distance 56 m
</td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.459993&right=2.460593&top=48.926662&bottom=48.926062&addtags=highway=bus_stop%7Cpublic_transport=platform%7Cname=Stade Charles Sage&select=node2480159335" target="hide">compléter arrêt</a></td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.459993&right=2.460593&top=48.926662&bottom=48.926062" onclick="map.fitBounds([[48.926062,2.459993],[48.926662,2.460593]]);" target="hide">zoom JOSM</a></td>
</tr>
<tr>
<td style="background-color:#FF0000";>Daniel Fery</td>
<td style="background-color:#0EFF00";> (node similaire à 0%) - distance 7 m
</td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.459032&right=2.459632&top=48.923761&bottom=48.923161&addtags=highway=bus_stop%7Cpublic_transport=platform%7Cname=Daniel Fery&select=node933859815" target="hide">compléter arrêt</a></td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.459032&right=2.459632&top=48.923761&bottom=48.923161" onclick="map.fitBounds([[48.923161,2.459032],[48.923761,2.459632]]);" target="hide">zoom JOSM</a></td>
</tr>
<tr>
<td style="background-color:#FF0000";>Barbusse - Croizat</td>
<td style="background-color:#10FF00";> (node similaire à 0%) - distance 8 m
</td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.456493&right=2.457093&top=48.922954&bottom=48.922354&addtags=highway=bus_stop%7Cpublic_transport=platform%7Cname=Barbusse - Croizat&select=node1436226552" target="hide">compléter arrêt</a></td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.456493&right=2.457093&top=48.922954&bottom=48.922354" onclick="map.fitBounds([[48.922354,2.456493],[48.922954,2.457093]]);" target="hide">zoom JOSM</a></td>
</tr>
<tr>
<td style="background-color:#FF0000";>Auguste Blanqui</td>
<td style="background-color:#13FF00";> (node similaire à 0%) - distance 9 m
</td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.453585&right=2.454185&top=48.921447&bottom=48.920847&addtags=highway=bus_stop%7Cpublic_transport=platform%7Cname=Auguste Blanqui&select=node2479287512" target="hide">compléter arrêt</a></td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.453585&right=2.454185&top=48.921447&bottom=48.920847" onclick="map.fitBounds([[48.920847,2.453585],[48.921447,2.454185]]);" target="hide">zoom JOSM</a></td>
</tr>
<tr>
<td style="background-color:#FF0000";>Place du 19 Mars 1962</td>
<td style="background-color:#03FF00";> (node similaire à 0%) - distance 3 m
</td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.450746&right=2.451346&top=48.920372&bottom=48.919772&addtags=highway=bus_stop%7Cpublic_transport=platform%7Cname=Place du 19 Mars 1962&select=node2480664204" target="hide">compléter arrêt</a></td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.450746&right=2.451346&top=48.920372&bottom=48.919772" onclick="map.fitBounds([[48.919772,2.450746],[48.920372,2.451346]]);" target="hide">zoom JOSM</a></td>
</tr>
<tr>
<td style="background-color:#00FF00";>Mairie de Drancy</td>
<td style="background-color:#1BFF00";>Mairie de Drancy (node similaire à 100%) - distance 12 m
</td>
<td></td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.446511&right=2.447111&top=48.92335&bottom=48.92275" onclick="map.fitBounds([[48.92275,2.446511],[48.92335,2.447111]]);" target="hide">zoom JOSM</a></td>
</tr>
<tr>
<td style="background-color:#FFE400";>Jean-Pierre Timbaud</td>
<td style="background-color:#10FF00";>J.P Timbaud (node similaire à 45%) - distance 8 m
</td>
<td></td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.44072&right=2.44132&top=48.925791&bottom=48.925191" onclick="map.fitBounds([[48.925191,2.44072],[48.925791,2.44132]]);" target="hide">zoom JOSM</a></td>
</tr>
<tr>
<td style="background-color:#FF0000";>Centre Culturel</td>
<td style="background-color:#0BFF00";> (node similaire à 0%) - distance 6 m
</td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.438431&right=2.439031&top=48.9268&bottom=48.9262&addtags=highway=bus_stop%7Cpublic_transport=platform%7Cname=Centre Culturel&select=node2482536215" target="hide">compléter arrêt</a></td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.438431&right=2.439031&top=48.9268&bottom=48.9262" onclick="map.fitBounds([[48.9262,2.438431],[48.9268,2.439031]]);" target="hide">zoom JOSM</a></td>
</tr>
<tr>
<td style="background-color:#FF0000";>Faidherbe - Ferry</td>
<td style="background-color:#03FF00";> (node similaire à 0%) - distance 3 m
</td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.435713&right=2.436313&top=48.924807&bottom=48.924207&addtags=highway=bus_stop%7Cpublic_transport=platform%7Cname=Faidherbe - Ferry&select=node2482541015" target="hide">compléter arrêt</a></td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.435713&right=2.436313&top=48.924807&bottom=48.924207" onclick="map.fitBounds([[48.924207,2.435713],[48.924807,2.436313]]);" target="hide">zoom JOSM</a></td>
</tr>
<tr>
<td style="background-color:#FF0000";>Faidherbe - Danton</td>
<td style="background-color:#20FF00";> (node similaire à 0%) - distance 14 m
</td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.432489&right=2.433089&top=48.921745&bottom=48.921145&addtags=highway=bus_stop%7Cpublic_transport=platform%7Cname=Faidherbe - Danton&select=node2482554563" target="hide">compléter arrêt</a></td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.432489&right=2.433089&top=48.921745&bottom=48.921145" onclick="map.fitBounds([[48.921145,2.432489],[48.921745,2.433089]]);" target="hide">zoom JOSM</a></td>
</tr>
<tr>
<td style="background-color:#FF0000";>Faidherbe - Bize</td>
<td style="background-color:#13FF00";> (node similaire à 0%) - distance 9 m
</td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.430627&right=2.431227&top=48.917693&bottom=48.917093&addtags=highway=bus_stop%7Cpublic_transport=platform%7Cname=Faidherbe - Bize&select=node2482561174" target="hide">compléter arrêt</a></td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.430627&right=2.431227&top=48.917693&bottom=48.917093" onclick="map.fitBounds([[48.917093,2.430627],[48.917693,2.431227]]);" target="hide">zoom JOSM</a></td>
</tr>
<tr>
<td style="background-color:#FF0000";>Hopital Avicenne</td>
<td style="background-color:#D8FF00";> (node similaire à 0%) - distance 85 m
</td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.425374&right=2.425974&top=48.916196&bottom=48.915596&addtags=highway=bus_stop%7Cpublic_transport=platform%7Cname=Hopital Avicenne&select=node2482491964" target="hide">compléter arrêt</a></td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.425374&right=2.425974&top=48.916196&bottom=48.915596" onclick="map.fitBounds([[48.915596,2.425374],[48.916196,2.425974]]);" target="hide">zoom JOSM</a></td>
</tr>
<tr>
<td style="background-color:#FF0000";>Cite de la Resistance.</td>
<td style="background-color:#32FF00";> (node similaire à 0%) - distance 21 m
</td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.419229&right=2.419829&top=48.919283&bottom=48.918683&addtags=highway=bus_stop%7Cpublic_transport=platform%7Cname=Cite de la Resistance.&select=node2482437803" target="hide">compléter arrêt</a></td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.419229&right=2.419829&top=48.919283&bottom=48.918683" onclick="map.fitBounds([[48.918683,2.419229],[48.919283,2.419829]]);" target="hide">zoom JOSM</a></td>
</tr>
<tr>
<td style="background-color:#FF0000";>Place de l'Amitie</td>
<td style="background-color:#4FFF00";> (node similaire à 0%) - distance 32 m
</td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.420993&right=2.421593&top=48.921924&bottom=48.921324&addtags=highway=bus_stop%7Cpublic_transport=platform%7Cname=Place de l'Amitie&select=node2482439740" target="hide">compléter arrêt</a></td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.420993&right=2.421593&top=48.921924&bottom=48.921324" onclick="map.fitBounds([[48.921324,2.420993],[48.921924,2.421593]]);" target="hide">zoom JOSM</a></td>
</tr>
<tr>
<td style="background-color:#FF0000";>Cite de la Resistance</td>
<td style="background-color:#0BFF00";> (node similaire à 0%) - distance 6 m
</td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.418233&right=2.418833&top=48.918655&bottom=48.918055&addtags=highway=bus_stop%7Cpublic_transport=platform%7Cname=Cite de la Resistance&select=node2482432763" target="hide">compléter arrêt</a></td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.418233&right=2.418833&top=48.918655&bottom=48.918055" onclick="map.fitBounds([[48.918055,2.418233],[48.918655,2.418833]]);" target="hide">zoom JOSM</a></td>
</tr>
<tr>
<td style="background-color:#FF0000";>Iut Paris 13</td>
<td style="background-color:#FFE700";> (node similaire à 0%) - distance 109 m
</td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.416741&right=2.417341&top=48.914809&bottom=48.914209&addtags=highway=bus_stop%7Cpublic_transport=platform%7Cname=Iut Paris 13&select=node2482448465" target="hide">compléter arrêt</a></td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.416741&right=2.417341&top=48.914809&bottom=48.914209" onclick="map.fitBounds([[48.914209,2.416741],[48.914809,2.417341]]);" target="hide">zoom JOSM</a></td>
</tr>
<tr>
<td style="background-color:#97FF00";>Les Courtillieres</td>
<td style="background-color:#22FF00";>Les Courtillières (node similaire à 70%) - distance 15 m
</td>
<td></td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.416548&right=2.417148&top=48.913587&bottom=48.912987" onclick="map.fitBounds([[48.912987,2.416548],[48.913587,2.417148]]);" target="hide">zoom JOSM</a></td>
</tr>
<tr>
<td style="background-color:#54FF00";>Cite du Pont de Pierre</td>
<td style="background-color:#1BFF00";>Cité du Pont de Pierre (node similaire à 83%) - distance 12 m
</td>
<td></td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.415848&right=2.416448&top=48.910847&bottom=48.910247" onclick="map.fitBounds([[48.910247,2.415848],[48.910847,2.416448]]);" target="hide">zoom JOSM</a></td>
</tr>
<tr>
<td style="background-color:#00FF00";>Division Leclerc - Stendhal</td>
<td style="background-color:#5CFF00";>Division Leclerc–Stendhal (node similaire à 100%) - distance 37 m
</td>
<td></td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.412114&right=2.412714&top=48.911847&bottom=48.911247" onclick="map.fitBounds([[48.911247,2.412114],[48.911847,2.412714]]);" target="hide">zoom JOSM</a></td>
</tr>
<tr>
<td style="background-color:#FF8700";>Maison de Quartier - Courtillieres</td>
<td style="background-color:#66FF00";>Division Leclerc–Courtillières (node similaire à 27%) - distance 41 m
</td>
<td></td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.407209&right=2.407809&top=48.914114&bottom=48.913514" onclick="map.fitBounds([[48.913514,2.407209],[48.914114,2.407809]]);" target="hide">zoom JOSM</a></td>
</tr>
<tr>
<td style="background-color:#6EFF00";>Fort d'Aubervilliers-Metro</td>
<td style="background-color:#2DFF00";>Fort d'Aubervilliers (node similaire à 78%) - distance 19 m
</td>
<td></td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.403977&right=2.404577&top=48.914278&bottom=48.913678" onclick="map.fitBounds([[48.913678,2.403977],[48.914278,2.404577]]);" target="hide">zoom JOSM</a></td>
</tr>
</table>
</div>
<div id="map" style="width: 640px; height: 400px; float: left;">
</div></div>


<script type='text/javascript'> // couche "osmfr" 
var osmfr = L.tileLayer('http://{s}.tile.openstreetmap.fr/osmfr/{z}/{x}/{y}.png', 
{
    attribution: 'donn&eacute;es &copy; <a href="http://osm.org/copyright">OpenStreetMap</a>/ODbL - rendu cquest',
    minZoom: 1,
    maxZoom: 20
});
  
// liste des couches de base
var baseMaps = {
    "Rendu FR": osmfr
};
var geojsonFeature ={
  "type":"Feature",
  "geometry": {
	"type":"GeometryCollection",
	"geometries": [
	{"type":"LineString","coordinates":[[2.455384,48.93282],[2.456103,48.930743],[2.460293,48.926362],[2.459332,48.923461],[2.456793,48.922654],[2.453885,48.921147],[2.451046,48.920072],[2.446811,48.92305],[2.44102,48.925491],[2.438731,48.9265],[2.436013,48.924507],[2.432789,48.921445],[2.430927,48.917393],[2.425674,48.915896],[2.419529,48.918983],[2.421293,48.921624],[2.418533,48.918355],[2.417041,48.914509],[2.416848,48.913287],[2.416148,48.910547],[2.412414,48.911547],[2.407509,48.913814],[2.404277,48.913978]]},
	{"type":"Point","coordinates":[2.455384,48.93282]}]},

  "properties": {
	"name":"test"
  }
};


map = L.map('map', { center: [47.000,2.000], zoom: 10, layers: [osmfr] } );
json = L.geoJSON(geojsonFeature).addTo(map); 

var myStyle = {
    "color": "#ff7800",
    "weight": 5,
    "opacity": 0.65
};

var nodes = [];
var legs;
var loadurl="http://localhost:8111/load_object?referrers=true&objects=";


function get_itin() {
var geojsonLayer = new L.GeoJSON.AJAX("http://router.project-osrm.org/match/v1/driving/2.455384,48.93282;2.456103,48.930743;2.460293,48.926362;2.459332,48.923461;2.456793,48.922654;2.453885,48.921147;2.451046,48.920072;2.446811,48.92305;2.44102,48.925491;2.438731,48.9265;2.436013,48.924507;2.432789,48.921445;2.430927,48.917393;2.425674,48.915896;2.419529,48.918983;2.421293,48.921624;2.418533,48.918355;2.417041,48.914509;2.416848,48.913287;2.416148,48.910547;2.412414,48.911547;2.407509,48.913814;2.404277,48.913978?timestamps=1487487600;1487487660;1487487720;1487487840;1487487840;1487487900;1487487960;1487488020;1487488140;1487488140;1487488200;1487488260;1487488320;1487488500;1487488620;1487488740;1487488800;1487488920;1487488920;1487489040;1487489100;1487489160;1487489220&radiuses=20;20;20;20;20;20;20;20;20;20;20;20;20;20;20;20;20;20;20;20;20;20;20&overview=full&geometries=geojson&generate_hints=false&annotations=true",{
	style:myStyle,
	middleware:function(data){
legs = data.matchings[0].legs;
for(var i in legs) {
nodes.push(legs[i].annotation.nodes);
}

for(i=0; i < nodes.length; i++){
for(j=0; j < nodes[i].length; j++) {
	loadurl += "n" + nodes[i][j] + ",";
}
}

document.getElementById("load_josm").innerHTML = '<a href="'+loadurl+'" target="hide">Load JOSM</a>';

		return data.matchings[0].geometry;
	}
});

geojsonLayer.addTo(map);
};



map.fitBounds(json.getBounds());
jj=json.getLayers()[0]._layers;

idx=Object.keys(jj)[0]

//debugger;
var decorator = L.polylineDecorator(jj[idx]._latlngs, 
{
    patterns: [
            {offset: 25, repeat: 50, symbol: L.Symbol.arrowHead({pixelSize: 15, pathOptions: 
{fillOpacity: 1, weight: 0}})}
        ]
}).addTo(map);

// ajout de l'échelle
L.control.scale().addTo(map);

</script>


</body>
</html>
