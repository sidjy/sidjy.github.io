<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
		<meta http-equiv="Content-Script-Type" content="text/javascript" />
		<meta http-equiv="Content-Style-Type" content="text/css" />
		<title>Interface GTFS</title>
		<link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.2/dist/leaflet.css" />
		<script src="https://unpkg.com/leaflet@1.0.2/dist/leaflet.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-polylinedecorator/1.1.0/leaflet.polylineDecorator.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-ajax/2.1.0/leaflet.ajax.min.js"></script>
	</head>
<body>
<p><a href="type_of_pt.html">Home</a>
 - <a href="get_agency_3.html">Bus</a>
 - <a href="get_routes_3_442.html">442</a>
 - <a href="get_trips_3_442_100100105:105_1.html">100100105:105 1</a>
 81617250-1369455
</p>
<p><button onclick="get_itin()">Itinéraire</button></p>
<p id="load_josm"></p>
<table id="osm"><tr>
<th><a href="http://localhost:8111/load_data?new_layer=false&data=%3C%3Fxml%20version%3D%271.0%27%20encoding%3D%27UTF-8%27%3F%3E%0A%3Cosm%20version%3D%220.6%22%20upload%3D%22false%22%3E%0A%3Crelation%20id%3D%22-1%22%3E%0A%3Ctag%20k%3D%22type%22%20v%3D%22route%22%2F%3E%0A%3Ctag%20k%3D%22route%22%20v%3D%22bus%22%2F%3E%0A%3Ctag%20k%3D%22public_transport%3Aversion%22%20v%3D%222%22%2F%3E%0A%3Ctag%20k%3D%22name%22%20v%3D%22Bus%20105%20%3A%20Mairie%20des%20Pavillons-Sous-Bois%20%E2%86%92%20Porte%20des%20Lilas-Metro%22%2F%3E%0A%3Ctag%20k%3D%22from%22%20v%3D%22Mairie%20des%20Pavillons-Sous-Bois%22%2F%3E%0A%3Ctag%20k%3D%22to%22%20v%3D%22Porte%20des%20Lilas-Metro%22%2F%3E%0A%3Ctag%20k%3D%22ref%22%20v%3D%22105%22%2F%3E%0A%3Ctag%20k%3D%22network%22%20v%3D%22RATP%22%2F%3E%0A%3Ctag%20k%3D%22colour%22%20v%3D%22%23DE8B53%22%2F%3E%0A%3C%2Frelation%3E%0A%3C%2Fosm%3E%0A" target="hide">Créer la relation route dans JOSM</a> (attention aux doublons)
</th></tr>
<tr><td>name:Bus 105 : Mairie des Pavillons-Sous-Bois → Porte des Lilas-Metro</td></tr>
<tr><td>from:Mairie des Pavillons-Sous-Bois</td></tr>
<tr><td>to:Porte des Lilas-Metro</td></tr>
<tr><td>network:RATP</td></tr>
<tr><td>ref:105</td></tr>
<tr><td>colour:#DE8B53</td></tr>
</table>
<iframe name="hide" style="display: None;"></iframe>
<div>
<div style="width: 640px; float: left;">
<table id="stops" class="main">
<tr><th>name</th><th>OSM?</th><th>ajout</th><th>?</th></tr>

<tr>
<td style="background-color:#00FF00";>Mairie des Pavillons-Sous-Bois</td>
<td style="background-color:#3CFF00";>Mairie des Pavillons-sous-Bois (node similaire à 100%) - distance 25 m
</td>
<td></td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.507868&right=2.508468&top=48.902904&bottom=48.902304" onclick="map.fitBounds([[48.902304,2.507868],[48.902904,2.508468]]);" target="hide">zoom JOSM</a></td>
</tr>
<tr>
<td style="background-color:#00FF00";>Pierre Brossolette - la Basoche</td>
<td style="background-color:#15FF00";>Pierre Brossolette - La Basoche (node similaire à 100%) - distance 10 m
</td>
<td></td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.504915&right=2.505515&top=48.904463&bottom=48.903863" onclick="map.fitBounds([[48.903863,2.504915],[48.904463,2.505515]]);" target="hide">zoom JOSM</a></td>
</tr>
<tr>
<td style="background-color:#00FF00";>Virginie</td>
<td style="background-color:#22FF00";>Virginie (node similaire à 100%) - distance 15 m
</td>
<td></td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.501843&right=2.502443&top=48.90294&bottom=48.90234" onclick="map.fitBounds([[48.90234,2.501843],[48.90294,2.502443]]);" target="hide">zoom JOSM</a></td>
</tr>
<tr>
<td style="background-color:#00FF00";>Albert Thomas</td>
<td style="background-color:#69FF00";>Albert Thomas (node similaire à 100%) - distance 42 m
</td>
<td></td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.50032&right=2.50092&top=48.900102&bottom=48.899502" onclick="map.fitBounds([[48.899502,2.50032],[48.900102,2.50092]]);" target="hide">zoom JOSM</a></td>
</tr>
<tr>
<td style="background-color:#00FF00";>Marcel Sembat</td>
<td style="background-color:#0EFF00";>Marcel Sembat (node similaire à 100%) - distance 7 m
</td>
<td></td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.496094&right=2.496694&top=48.900054&bottom=48.899454" onclick="map.fitBounds([[48.899454,2.496094],[48.900054,2.496694]]);" target="hide">zoom JOSM</a></td>
</tr>
<tr>
<td style="background-color:#00FF00";>Professeur Vaillant</td>
<td style="background-color:#1BFF00";>Professeur Vaillant (node similaire à 100%) - distance 12 m
</td>
<td></td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.490767&right=2.491367&top=48.901013&bottom=48.900413" onclick="map.fitBounds([[48.900413,2.490767],[48.901013,2.491367]]);" target="hide">zoom JOSM</a></td>
</tr>
<tr>
<td style="background-color:#00FF00";>Pierre Brossolette</td>
<td style="background-color:#49FF00";>Pierre Brossolette (node similaire à 100%) - distance 30 m
</td>
<td></td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.486258&right=2.486858&top=48.902125&bottom=48.901525" onclick="map.fitBounds([[48.901525,2.486258],[48.902125,2.486858]]);" target="hide">zoom JOSM</a></td>
</tr>
<tr>
<td style="background-color:#C6FF00";>Cimetiere - Hotel de Ville</td>
<td style="background-color:#A4FF00";>Cimetière - Hôtel de Ville (node similaire à 61%) - distance 65 m
</td>
<td></td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.48277&right=2.48337&top=48.902542&bottom=48.901942" onclick="map.fitBounds([[48.901942,2.48277],[48.902542,2.48337]]);" target="hide">zoom JOSM</a></td>
</tr>
<tr>
<td style="background-color:#A2FF00";>Eglise de Bondy</td>
<td style="background-color:#3FFF00";>Église de Bondy (node similaire à 68%) - distance 26 m
</td>
<td></td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.480673&right=2.481273&top=48.903372&bottom=48.902772" onclick="map.fitBounds([[48.902772,2.480673],[48.903372,2.481273]]);" target="hide">zoom JOSM</a></td>
</tr>
<tr>
<td style="background-color:#FF0000";>Lycees Pagnol - Renoir</td>
<td style="background-color:#42FF00";>Bondy Gambetta (node similaire à 0%) - distance 27 m
</td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.473573&right=2.474173&top=48.904566&bottom=48.903966&addtags=highway=bus_stop%7Cpublic_transport=platform%7Cname=Lycees Pagnol - Renoir&select=node1260774044" target="hide">compléter arrêt</a></td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.473573&right=2.474173&top=48.904566&bottom=48.903966" onclick="map.fitBounds([[48.903966,2.473573],[48.904566,2.474173]]);" target="hide">zoom JOSM</a></td>
</tr>
<tr>
<td style="background-color:#00FF00";>Avenue de Rosny</td>
<td style="background-color:#18FF00";>Avenue de Rosny (node similaire à 100%) - distance 11 m
</td>
<td></td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.471079&right=2.471679&top=48.904722&bottom=48.904122" onclick="map.fitBounds([[48.904122,2.471079],[48.904722,2.471679]]);" target="hide">zoom JOSM</a></td>
</tr>
<tr>
<td style="background-color:#73FF00";>Pont de Bondy - Avenue de Rosny</td>
<td style="background-color:#13FF00";>Pont de Bondy - Avenue de Rosny - Tramway (node similaire à 77%) - distance 9 m
</td>
<td></td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.469169&right=2.469769&top=48.904212&bottom=48.903612" onclick="map.fitBounds([[48.903612,2.469169],[48.904212,2.469769]]);" target="hide">zoom JOSM</a></td>
</tr>
<tr>
<td style="background-color:#FFEF00";>Nouvelle Piscine</td>
<td style="background-color:#28FF00";>Piscine (node similaire à 47%) - distance 17 m
</td>
<td></td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.467079&right=2.467679&top=48.902686&bottom=48.902086" onclick="map.fitBounds([[48.902086,2.467079],[48.902686,2.467679]]);" target="hide">zoom JOSM</a></td>
</tr>
<tr>
<td style="background-color:#CBFF00";>Petit Noisy</td>
<td style="background-color:#20FF00";>Petit Noisy - Tramway (node similaire à 60%) - distance 14 m
</td>
<td></td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.465126&right=2.465726&top=48.9009&bottom=48.9003" onclick="map.fitBounds([[48.9003,2.465126],[48.9009,2.465726]]);" target="hide">zoom JOSM</a></td>
</tr>
<tr>
<td style="background-color:#00FF00";>Denis Papin</td>
<td style="background-color:#3FFF00";>Denis Papin (node similaire à 100%) - distance 26 m
</td>
<td></td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.463254&right=2.463854&top=48.899185&bottom=48.898585" onclick="map.fitBounds([[48.898585,2.463254],[48.899185,2.463854]]);" target="hide">zoom JOSM</a></td>
</tr>
<tr>
<td style="background-color:#00FF00";>Noisy-le-sec RER</td>
<td style="background-color:#25FF00";>Noisy le Sec RER (node similaire à 100%) - distance 16 m
</td>
<td></td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.459989&right=2.460589&top=48.896394&bottom=48.895794" onclick="map.fitBounds([[48.895794,2.459989],[48.896394,2.460589]]);" target="hide">zoom JOSM</a></td>
</tr>
<tr>
<td style="background-color:#00FF00";>Saint-Jean</td>
<td style="background-color:#08FF00";>Saint-Jean (node similaire à 100%) - distance 5 m
</td>
<td></td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.456808&right=2.457408&top=48.893926&bottom=48.893326" onclick="map.fitBounds([[48.893326,2.456808],[48.893926,2.457408]]);" target="hide">zoom JOSM</a></td>
</tr>
<tr>
<td style="background-color:#B7FF00";>Marche des Decouvertes</td>
<td style="background-color:#66FF00";>Marché des Découvertes (node similaire à 64%) - distance 41 m
</td>
<td></td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.454172&right=2.454772&top=48.891753&bottom=48.891153" onclick="map.fitBounds([[48.891153,2.454172],[48.891753,2.454772]]);" target="hide">zoom JOSM</a></td>
</tr>
<tr>
<td style="background-color:#00FF00";>Jeanne d'arc</td>
<td style="background-color:#47FF00";>Jeanne d'Arc (node similaire à 100%) - distance 29 m
</td>
<td></td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.451906&right=2.452506&top=48.890021&bottom=48.889421" onclick="map.fitBounds([[48.889421,2.451906],[48.890021,2.452506]]);" target="hide">zoom JOSM</a></td>
</tr>
<tr>
<td style="background-color:#FF5300";>Helene</td>
<td style="background-color:#10FF00";>Hélène (node similaire à 17%) - distance 8 m
</td>
<td></td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.449886&right=2.450486&top=48.88854&bottom=48.88794" onclick="map.fitBounds([[48.88794,2.449886],[48.88854,2.450486]]);" target="hide">zoom JOSM</a></td>
</tr>
<tr>
<td style="background-color:#00FF00";>Hoche</td>
<td style="background-color:#0BFF00";>Hoche (node similaire à 100%) - distance 6 m
</td>
<td></td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.446338&right=2.446938&top=48.886728&bottom=48.886128" onclick="map.fitBounds([[48.886128,2.446338],[48.886728,2.446938]]);" target="hide">zoom JOSM</a></td>
</tr>
<tr>
<td style="background-color:#00FF00";>Rue du Parc</td>
<td style="background-color:#3CFF00";>Rue du Parc (node similaire à 100%) - distance 25 m
</td>
<td></td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.444075&right=2.444675&top=48.886137&bottom=48.885537" onclick="map.fitBounds([[48.885537,2.444075],[48.886137,2.444675]]);" target="hide">zoom JOSM</a></td>
</tr>
<tr>
<td style="background-color:#00FF00";>Carnot</td>
<td style="background-color:#FFD700";>Carnot (node similaire à 100%) - distance 115 m
</td>
<td></td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.44027&right=2.44087&top=48.884918&bottom=48.884318" onclick="map.fitBounds([[48.884318,2.44027],[48.884918,2.44087]]);" target="hide">zoom JOSM</a></td>
</tr>
<tr>
<td style="background-color:#00FF00";>Mairie de Romainville</td>
<td style="background-color:#28FF00";>Mairie de Romainville (node similaire à 100%) - distance 17 m
</td>
<td></td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.434439&right=2.435039&top=48.885489&bottom=48.884889" onclick="map.fitBounds([[48.884889,2.434439],[48.885489,2.435039]]);" target="hide">zoom JOSM</a></td>
</tr>
<tr>
<td style="background-color:#FF0000";>Liberte</td>
<td style="background-color:#FF0000";>no</td>
<td><a href="http://localhost:8111/add_node?lat=48.883111&lon=2.426381&addtags=highway=bus_stop%7Cpublic_transport=platform%7Cname=Liberte" target="hide">ajouter arrêt</a></td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.426081&right=2.426681&top=48.883411&bottom=48.882811" onclick="map.fitBounds([[48.882811,2.426081],[48.883411,2.426681]]);" target="hide">zoom JOSM</a></td>
</tr>
<tr>
<td style="background-color:#FF0000";>Joseph Depinay</td>
<td style="background-color:#78FF00";>Sablons (node similaire à 0%) - distance 48 m
</td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.422345&right=2.422945&top=48.882173&bottom=48.881573&addtags=highway=bus_stop%7Cpublic_transport=platform%7Cname=Joseph Depinay&select=node1459821834" target="hide">compléter arrêt</a></td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.422345&right=2.422945&top=48.882173&bottom=48.881573" onclick="map.fitBounds([[48.881573,2.422345],[48.882173,2.422945]]);" target="hide">zoom JOSM</a></td>
</tr>
<tr>
<td style="background-color:#FF0000";>Paul de Kock</td>
<td style="background-color:#FFFF00";>Maréchal Juin (node similaire à 0%) - distance 100 m
</td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.420409&right=2.421009&top=48.881563&bottom=48.880963&addtags=highway=bus_stop%7Cpublic_transport=platform%7Cname=Paul de Kock&select=node2875012656" target="hide">compléter arrêt</a></td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.420409&right=2.421009&top=48.881563&bottom=48.880963" onclick="map.fitBounds([[48.880963,2.420409],[48.881563,2.421009]]);" target="hide">zoom JOSM</a></td>
</tr>
<tr>
<td style="background-color:#FF0000";>Mairie des Lilas</td>
<td style="background-color:#3FFF00";> (node similaire à 0%) - distance 26 m
</td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.41602&right=2.41662&top=48.880218&bottom=48.879618&addtags=highway=bus_stop%7Cpublic_transport=platform%7Cname=Mairie des Lilas&select=node3710903500" target="hide">compléter arrêt</a></td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.41602&right=2.41662&top=48.880218&bottom=48.879618" onclick="map.fitBounds([[48.879618,2.41602],[48.880218,2.41662]]);" target="hide">zoom JOSM</a></td>
</tr>
<tr>
<td style="background-color:#CBFF00";>Les Bruyeres</td>
<td style="background-color:#06FF00";>Les Bruyères (node similaire à 60%) - distance 4 m
</td>
<td></td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.412121&right=2.412721&top=48.879214&bottom=48.878614" onclick="map.fitBounds([[48.878614,2.412121],[48.879214,2.412721]]);" target="hide">zoom JOSM</a></td>
</tr>
<tr>
<td style="background-color:#FF0000";>Porte des Lilas-Metro</td>
<td style="background-color:#B1FF00";> (node similaire à 0%) - distance 70 m
</td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.408194&right=2.408794&top=48.877482&bottom=48.876882&addtags=highway=bus_stop%7Cpublic_transport=platform%7Cname=Porte des Lilas-Metro&select=node1430255772" target="hide">compléter arrêt</a></td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.408194&right=2.408794&top=48.877482&bottom=48.876882" onclick="map.fitBounds([[48.876882,2.408194],[48.877482,2.408794]]);" target="hide">zoom JOSM</a></td>
</tr>
</table>
</div>
<div id="map" style="width: 640px; height: 400px; float: left;">
</div></div>


<script type='text/javascript'> // couche "osmfr" 
var osmfr = L.tileLayer('http://{s}.tile.openstreetmap.fr/osmfr/{z}/{x}/{y}.png', 
{
    attribution: 'donn&eacute;es &copy; <a href="http://osm.org/copyright">OpenStreetMap</a>/ODbL - rendu cquest',
    minZoom: 1,
    maxZoom: 20
});
  
// liste des couches de base
var baseMaps = {
    "Rendu FR": osmfr
};
var geojsonFeature ={
  "type":"Feature",
  "geometry": {
	"type":"GeometryCollection",
	"geometries": [
	{"type":"LineString","coordinates":[[2.508168,48.902604],[2.505215,48.904163],[2.502143,48.90264],[2.50062,48.899802],[2.496394,48.899754],[2.491067,48.900713],[2.486558,48.901825],[2.48307,48.902242],[2.480973,48.903072],[2.473873,48.904266],[2.471379,48.904422],[2.469469,48.903912],[2.467379,48.902386],[2.465426,48.9006],[2.463554,48.898885],[2.460289,48.896094],[2.457108,48.893626],[2.454472,48.891453],[2.452206,48.889721],[2.450186,48.88824],[2.446638,48.886428],[2.444375,48.885837],[2.44057,48.884618],[2.434739,48.885189],[2.426381,48.883111],[2.422645,48.881873],[2.420709,48.881263],[2.41632,48.879918],[2.412421,48.878914],[2.408494,48.877182]]},
	{"type":"Point","coordinates":[2.508168,48.902604]}]},

  "properties": {
	"name":"test"
  }
};


map = L.map('map', { center: [47.000,2.000], zoom: 10, layers: [osmfr] } );
json = L.geoJSON(geojsonFeature).addTo(map); 

var myStyle = {
    "color": "#ff7800",
    "weight": 5,
    "opacity": 0.65
};

var nodes = [];
var legs;
var loadurl="http://localhost:8111/load_object?referrers=true&objects=";


function get_itin() {
var geojsonLayer = new L.GeoJSON.AJAX("http://router.project-osrm.org/match/v1/driving/2.508168,48.902604;2.505215,48.904163;2.502143,48.90264;2.50062,48.899802;2.496394,48.899754;2.491067,48.900713;2.486558,48.901825;2.48307,48.902242;2.480973,48.903072;2.473873,48.904266;2.471379,48.904422;2.469469,48.903912;2.467379,48.902386;2.465426,48.9006;2.463554,48.898885;2.460289,48.896094;2.457108,48.893626;2.454472,48.891453;2.452206,48.889721;2.450186,48.88824;2.446638,48.886428;2.444375,48.885837;2.44057,48.884618;2.434739,48.885189;2.426381,48.883111;2.422645,48.881873;2.420709,48.881263;2.41632,48.879918;2.412421,48.878914;2.408494,48.877182?timestamps=1487399400;1487399460;1487399520;1487399580;1487399640;1487399700;1487399760;1487399820;1487399940;1487399940;1487400000;1487400060;1487400120;1487400240;1487400300;1487400420;1487400480;1487400600;1487400720;1487400780;1487400840;1487400900;1487401020;1487401080;1487401140;1487401200;1487401260;1487401320;1487401380;1487401500&radiuses=20;20;20;20;20;20;20;20;20;20;20;20;20;20;20;20;20;20;20;20;20;20;20;20;20;20;20;20;20;20&overview=full&geometries=geojson&generate_hints=false&annotations=true",{
	style:myStyle,
	middleware:function(data){
legs = data.matchings[0].legs;
for(var i in legs) {
nodes.push(legs[i].annotation.nodes);
}

for(i=0; i < nodes.length; i++){
for(j=0; j < nodes[i].length; j++) {
	loadurl += "n" + nodes[i][j] + ",";
}
}

document.getElementById("load_josm").innerHTML = '<a href="'+loadurl+'" target="hide">Load JOSM</a>';

		return data.matchings[0].geometry;
	}
});

geojsonLayer.addTo(map);
};



map.fitBounds(json.getBounds());
jj=json.getLayers()[0]._layers;

idx=Object.keys(jj)[0]

//debugger;
var decorator = L.polylineDecorator(jj[idx]._latlngs, 
{
    patterns: [
            {offset: 25, repeat: 50, symbol: L.Symbol.arrowHead({pixelSize: 15, pathOptions: 
{fillOpacity: 1, weight: 0}})}
        ]
}).addTo(map);

// ajout de l'échelle
L.control.scale().addTo(map);

</script>


</body>
</html>
