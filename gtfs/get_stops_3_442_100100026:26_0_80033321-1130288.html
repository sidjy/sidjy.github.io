<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
		<meta http-equiv="Content-Script-Type" content="text/javascript" />
		<meta http-equiv="Content-Style-Type" content="text/css" />
		<title>Interface GTFS</title>
		<link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.2/dist/leaflet.css" />
		<script src="https://unpkg.com/leaflet@1.0.2/dist/leaflet.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-polylinedecorator/1.1.0/leaflet.polylineDecorator.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-ajax/2.1.0/leaflet.ajax.min.js"></script>
	</head>
<body>
<p><a href="type_of_pt.html">Home</a>
 - <a href="get_agency_3.html">Bus</a>
 - <a href="get_routes_3_442.html">442</a>
 - <a href="get_trips_3_442_100100026:26_0.html">100100026:26 0</a>
 80033321-1130288
</p>
<p><button onclick="get_itin()">Itinéraire</button></p>
<p id="load_josm"></p>
<table id="osm"><tr>
<th><a href="http://localhost:8111/load_data?new_layer=false&data=%3C%3Fxml%20version%3D%271.0%27%20encoding%3D%27UTF-8%27%3F%3E%0A%3Cosm%20version%3D%220.6%22%20upload%3D%22false%22%3E%0A%3Crelation%20id%3D%22-1%22%3E%0A%3Ctag%20k%3D%22type%22%20v%3D%22route%22%2F%3E%0A%3Ctag%20k%3D%22route%22%20v%3D%22bus%22%2F%3E%0A%3Ctag%20k%3D%22public_transport%3Aversion%22%20v%3D%222%22%2F%3E%0A%3Ctag%20k%3D%22name%22%20v%3D%22Bus%2026%20%3A%20Gare%20Saint-Lazare%20%E2%86%92%20Nation%20-%20Place%20des%20Antilles%22%2F%3E%0A%3Ctag%20k%3D%22from%22%20v%3D%22Gare%20Saint-Lazare%22%2F%3E%0A%3Ctag%20k%3D%22to%22%20v%3D%22Nation%20-%20Place%20des%20Antilles%22%2F%3E%0A%3Ctag%20k%3D%22ref%22%20v%3D%2226%22%2F%3E%0A%3Ctag%20k%3D%22network%22%20v%3D%22RATP%22%2F%3E%0A%3Ctag%20k%3D%22colour%22%20v%3D%22%23DE8B53%22%2F%3E%0A%3C%2Frelation%3E%0A%3C%2Fosm%3E%0A" target="hide">Créer la relation route dans JOSM</a> (attention aux doublons)
</th></tr>
<tr><td>name:Bus 26 : Gare Saint-Lazare → Nation - Place des Antilles</td></tr>
<tr><td>from:Gare Saint-Lazare</td></tr>
<tr><td>to:Nation - Place des Antilles</td></tr>
<tr><td>network:RATP</td></tr>
<tr><td>ref:26</td></tr>
<tr><td>colour:#DE8B53</td></tr>
</table>
<iframe name="hide" style="display: None;"></iframe>
<div>
<div style="width: 640px; float: left;">
<table id="stops" class="main">
<tr><th>name</th><th>OSM?</th><th>ajout</th><th>?</th></tr>

<tr>
<td style="background-color:#00FF00";>Gare Saint-Lazare</td>
<td style="background-color:#42FF00";>Gare Saint-Lazare (node similaire à 100%) - distance 27 m
</td>
<td></td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.324602&right=2.325202&top=48.875176&bottom=48.874576" onclick="map.fitBounds([[48.874576,2.324602],[48.875176,2.325202]]);" target="hide">zoom JOSM</a></td>
</tr>
<tr>
<td style="background-color:#CBFF00";>Trinite</td>
<td style="background-color:#13FF00";>Trinité (node similaire à 60%) - distance 9 m
</td>
<td></td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.331128&right=2.331728&top=48.876398&bottom=48.875798" onclick="map.fitBounds([[48.875798,2.331128],[48.876398,2.331728]]);" target="hide">zoom JOSM</a></td>
</tr>
<tr>
<td style="background-color:#69FF00";>Saint-Georges - Chateaudun</td>
<td style="background-color:#15FF00";>Saint-Georges - Châteaudun (node similaire à 79%) - distance 10 m
</td>
<td></td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.33651&right=2.33711&top=48.876309&bottom=48.875709" onclick="map.fitBounds([[48.875709,2.33651],[48.876309,2.33711]]);" target="hide">zoom JOSM</a></td>
</tr>
<tr>
<td style="background-color:#73FF00";>Carrefour de Chateaudun</td>
<td style="background-color:#0BFF00";>Carrefour de Châteaudun (node similaire à 77%) - distance 6 m
</td>
<td></td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.338922&right=2.339522&top=48.876129&bottom=48.875529" onclick="map.fitBounds([[48.875529,2.338922],[48.876129,2.339522]]);" target="hide">zoom JOSM</a></td>
</tr>
<tr>
<td style="background-color:#00FF00";>Cadet</td>
<td style="background-color:#1BFF00";>Cadet (node similaire à 100%) - distance 12 m
</td>
<td></td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.342178&right=2.342778&top=48.875922&bottom=48.875322" onclick="map.fitBounds([[48.875322,2.342178],[48.875922,2.342778]]);" target="hide">zoom JOSM</a></td>
</tr>
<tr>
<td style="background-color:#49FF00";>Square Montholon</td>
<td style="background-color:#D1FF00";>Square de Montholon (node similaire à 85%) - distance 82 m
</td>
<td></td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.346715&right=2.347315&top=48.876847&bottom=48.876247" onclick="map.fitBounds([[48.876247,2.346715],[48.876847,2.347315]]);" target="hide">zoom JOSM</a></td>
</tr>
<tr>
<td style="background-color:#00FF00";>Place Franz Liszt</td>
<td style="background-color:#78FF00";>Place Franz Liszt (node similaire à 100%) - distance 48 m
</td>
<td></td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.351907&right=2.352507&top=48.878249&bottom=48.877649" onclick="map.fitBounds([[48.877649,2.351907],[48.878249,2.352507]]);" target="hide">zoom JOSM</a></td>
</tr>
<tr>
<td style="background-color:#FF7200";>La Fayette - Saint Quentin - Gare du Nord</td>
<td style="background-color:#97FF00";>Lafayette - Dunkerque (node similaire à 23%) - distance 60 m
</td>
<td></td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.356145&right=2.356745&top=48.879336&bottom=48.878736" onclick="map.fitBounds([[48.878736,2.356145],[48.879336,2.356745]]);" target="hide">zoom JOSM</a></td>
</tr>
<tr>
<td style="background-color:#00FF00";>La Fayette - Dunkerque</td>
<td style="background-color:#3AFF00";>La Fayette - Dunkerque (node similaire à 100%) - distance 24 m
</td>
<td></td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.358244&right=2.358844&top=48.879865&bottom=48.879265" onclick="map.fitBounds([[48.879265,2.358244],[48.879865,2.358844]]);" target="hide">zoom JOSM</a></td>
</tr>
<tr>
<td style="background-color:#A7FF00";>Chateau Landon</td>
<td style="background-color:#0EFF00";>Château Landon (node similaire à 67%) - distance 7 m
</td>
<td></td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.362932&right=2.363532&top=48.881105&bottom=48.880505" onclick="map.fitBounds([[48.880505,2.362932],[48.881105,2.363532]]);" target="hide">zoom JOSM</a></td>
</tr>
<tr>
<td style="background-color:#00FF00";>Louis Blanc</td>
<td style="background-color:#35FF00";>Louis Blanc (node similaire à 100%) - distance 22 m
</td>
<td></td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.366066&right=2.366666&top=48.881949&bottom=48.881349" onclick="map.fitBounds([[48.881349,2.366066],[48.881949,2.366666]]);" target="hide">zoom JOSM</a></td>
</tr>
<tr>
<td style="background-color:#92FF00";>Jaures - Stalingrad</td>
<td style="background-color:#6BFF00";>Jaurès - Stalingrad (node similaire à 71%) - distance 43 m
</td>
<td></td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.368738&right=2.369338&top=48.88264&bottom=48.88204" onclick="map.fitBounds([[48.88204,2.368738],[48.88264,2.369338]]);" target="hide">zoom JOSM</a></td>
</tr>
<tr>
<td style="background-color:#F5FF00";>Marche Secretan</td>
<td style="background-color:#1DFF00";>Marché Secrétan (node similaire à 52%) - distance 13 m
</td>
<td></td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.373669&right=2.374269&top=48.880859&bottom=48.880259" onclick="map.fitBounds([[48.880259,2.373669],[48.880859,2.374269]]);" target="hide">zoom JOSM</a></td>
</tr>
<tr>
<td style="background-color:#00FF00";>Mathurin Moreau - Simon Bolivar</td>
<td style="background-color:#15FF00";>Mathurin-Moreau Simon Bolivar (node similaire à 100%) - distance 10 m
</td>
<td></td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.373941&right=2.374541&top=48.87908&bottom=48.87848" onclick="map.fitBounds([[48.87848,2.373941],[48.87908,2.374541]]);" target="hide">zoom JOSM</a></td>
</tr>
<tr>
<td style="background-color:#00FF00";>Atlas</td>
<td style="background-color:#03FF00";>Atlas (node similaire à 100%) - distance 3 m
</td>
<td></td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.375969&right=2.376569&top=48.876607&bottom=48.876007" onclick="map.fitBounds([[48.876007,2.375969],[48.876607,2.376569]]);" target="hide">zoom JOSM</a></td>
</tr>
<tr>
<td style="background-color:#00FF00";>Botzaris - Buttes Chaumont</td>
<td style="background-color:#10FF00";>Botzaris - Buttes Chaumont (node similaire à 100%) - distance 8 m
</td>
<td></td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.37977&right=2.38037&top=48.876453&bottom=48.875853" onclick="map.fitBounds([[48.875853,2.37977],[48.876453,2.38037]]);" target="hide">zoom JOSM</a></td>
</tr>
<tr>
<td style="background-color:#D6FF00";>Pyrenees - Belleville</td>
<td style="background-color:#25FF00";>Pyrénées - Belleville (node similaire à 58%) - distance 16 m
</td>
<td></td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.385559&right=2.386159&top=48.874105&bottom=48.873505" onclick="map.fitBounds([[48.873505,2.385559],[48.874105,2.386159]]);" target="hide">zoom JOSM</a></td>
</tr>
<tr>
<td style="background-color:#00FF00";>Jourdain</td>
<td style="background-color:#0BFF00";>Jourdain (node similaire à 100%) - distance 6 m
</td>
<td></td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.388761&right=2.389361&top=48.87396&bottom=48.87336" onclick="map.fitBounds([[48.87336,2.388761],[48.87396,2.389361]]);" target="hide">zoom JOSM</a></td>
</tr>
<tr>
<td style="background-color:#00FF00";>L'Ermitage</td>
<td style="background-color:#28FF00";>L'Ermitage (node similaire à 100%) - distance 17 m
</td>
<td></td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.391171&right=2.391771&top=48.872386&bottom=48.871786" onclick="map.fitBounds([[48.871786,2.391171],[48.872386,2.391771]]);" target="hide">zoom JOSM</a></td>
</tr>
<tr>
<td style="background-color:#FFEF00";>Pyrenees - Menilmontant</td>
<td style="background-color:#13FF00";>Pyrénées - Ménilmontant (node similaire à 47%) - distance 9 m
</td>
<td></td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.394397&right=2.394997&top=48.869841&bottom=48.869241" onclick="map.fitBounds([[48.869241,2.394397],[48.869841,2.394997]]);" target="hide">zoom JOSM</a></td>
</tr>
<tr>
<td style="background-color:#00FF00";>Villiers de l'Isle Adam</td>
<td style="background-color:#10FF00";>Villiers de l'Isle-Adam (node similaire à 100%) - distance 8 m
</td>
<td></td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.39626&right=2.39686&top=48.867477&bottom=48.866877" onclick="map.fitBounds([[48.866877,2.39626],[48.867477,2.39686]]);" target="hide">zoom JOSM</a></td>
</tr>
<tr>
<td style="background-color:#00FF00";>Gambetta - Mairie du 20e</td>
<td style="background-color:#25FF00";>Gambetta - Mairie du 20e (node similaire à 100%) - distance 16 m
</td>
<td></td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.39773&right=2.39833&top=48.865589&bottom=48.864989" onclick="map.fitBounds([[48.864989,2.39773],[48.865589,2.39833]]);" target="hide">zoom JOSM</a></td>
</tr>
<tr>
<td style="background-color:#00FF00";>Ramus</td>
<td style="background-color:#20FF00";>Ramus (node similaire à 100%) - distance 14 m
</td>
<td></td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.399891&right=2.400491&top=48.861606&bottom=48.861006" onclick="map.fitBounds([[48.861006,2.399891],[48.861606,2.400491]]);" target="hide">zoom JOSM</a></td>
</tr>
<tr>
<td style="background-color:#DBFF00";>Pyrenees - Bagnolet</td>
<td style="background-color:#0BFF00";>Pyrénées - Bagnolet (node similaire à 57%) - distance 6 m
</td>
<td></td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.402053&right=2.402653&top=48.859133&bottom=48.858533" onclick="map.fitBounds([[48.858533,2.402053],[48.859133,2.402653]]);" target="hide">zoom JOSM</a></td>
</tr>
<tr>
<td style="background-color:#00FF00";>Orteaux</td>
<td style="background-color:#18FF00";>Orteaux (node similaire à 100%) - distance 11 m
</td>
<td></td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.40461&right=2.40521&top=48.85631&bottom=48.85571" onclick="map.fitBounds([[48.85571,2.40461],[48.85631,2.40521]]);" target="hide">zoom JOSM</a></td>
</tr>
<tr>
<td style="background-color:#DBFF00";>Maraichers</td>
<td style="background-color:#08FF00";>Maraîchers (node similaire à 57%) - distance 5 m
</td>
<td></td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.405777&right=2.406377&top=48.852508&bottom=48.851908" onclick="map.fitBounds([[48.851908,2.405777],[48.852508,2.406377]]);" target="hide">zoom JOSM</a></td>
</tr>
<tr>
<td style="background-color:#00FF00";>La Plaine</td>
<td style="background-color:#18FF00";>La Plaine (node similaire à 100%) - distance 11 m
</td>
<td></td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.405992&right=2.406592&top=48.850575&bottom=48.849975" onclick="map.fitBounds([[48.849975,2.405992],[48.850575,2.406592]]);" target="hide">zoom JOSM</a></td>
</tr>
<tr>
<td style="background-color:#00FF00";>Cours de Vincennes</td>
<td style="background-color:#22FF00";>Cours de Vincennes (node similaire à 100%) - distance 15 m
</td>
<td></td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.405962&right=2.406562&top=48.848256&bottom=48.847656" onclick="map.fitBounds([[48.847656,2.405962],[48.848256,2.406562]]);" target="hide">zoom JOSM</a></td>
</tr>
<tr>
<td style="background-color:#00FF00";>Marsoulan</td>
<td style="background-color:#15FF00";>Marsoulan (node similaire à 100%) - distance 10 m
</td>
<td></td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.40253&right=2.40313&top=48.848177&bottom=48.847577" onclick="map.fitBounds([[48.847577,2.40253],[48.848177,2.40313]]);" target="hide">zoom JOSM</a></td>
</tr>
<tr>
<td style="background-color:#00FF00";>Nation - Place des Antilles</td>
<td style="background-color:#42FF00";>Nation-Place des Antilles (node similaire à 100%) - distance 27 m
</td>
<td></td>
<td><a href="http://localhost:8111/load_and_zoom?left=2.397846&right=2.398446&top=48.848548&bottom=48.847948" onclick="map.fitBounds([[48.847948,2.397846],[48.848548,2.398446]]);" target="hide">zoom JOSM</a></td>
</tr>
</table>
</div>
<div id="map" style="width: 640px; height: 400px; float: left;">
</div></div>


<script type='text/javascript'> // couche "osmfr" 
var osmfr = L.tileLayer('http://{s}.tile.openstreetmap.fr/osmfr/{z}/{x}/{y}.png', 
{
    attribution: 'donn&eacute;es &copy; <a href="http://osm.org/copyright">OpenStreetMap</a>/ODbL - rendu cquest',
    minZoom: 1,
    maxZoom: 20
});
  
// liste des couches de base
var baseMaps = {
    "Rendu FR": osmfr
};
var geojsonFeature ={
  "type":"Feature",
  "geometry": {
	"type":"GeometryCollection",
	"geometries": [
	{"type":"LineString","coordinates":[[2.324902,48.874876],[2.331428,48.876098],[2.33681,48.876009],[2.339222,48.875829],[2.342478,48.875622],[2.347015,48.876547],[2.352207,48.877949],[2.356445,48.879036],[2.358544,48.879565],[2.363232,48.880805],[2.366366,48.881649],[2.369038,48.88234],[2.373969,48.880559],[2.374241,48.87878],[2.376269,48.876307],[2.38007,48.876153],[2.385859,48.873805],[2.389061,48.87366],[2.391471,48.872086],[2.394697,48.869541],[2.39656,48.867177],[2.39803,48.865289],[2.400191,48.861306],[2.402353,48.858833],[2.40491,48.85601],[2.406077,48.852208],[2.406292,48.850275],[2.406262,48.847956],[2.40283,48.847877],[2.398146,48.848248]]},
	{"type":"Point","coordinates":[2.324902,48.874876]}]},

  "properties": {
	"name":"test"
  }
};


map = L.map('map', { center: [47.000,2.000], zoom: 10, layers: [osmfr] } );
json = L.geoJSON(geojsonFeature).addTo(map); 

var myStyle = {
    "color": "#ff7800",
    "weight": 5,
    "opacity": 0.65
};

var nodes = [];
var legs;
var loadurl="http://localhost:8111/load_object?referrers=true&objects=";


function get_itin() {
var geojsonLayer = new L.GeoJSON.AJAX("http://router.project-osrm.org/match/v1/driving/2.324902,48.874876;2.331428,48.876098;2.33681,48.876009;2.339222,48.875829;2.342478,48.875622;2.347015,48.876547;2.352207,48.877949;2.356445,48.879036;2.358544,48.879565;2.363232,48.880805;2.366366,48.881649;2.369038,48.88234;2.373969,48.880559;2.374241,48.87878;2.376269,48.876307;2.38007,48.876153;2.385859,48.873805;2.389061,48.87366;2.391471,48.872086;2.394697,48.869541;2.39656,48.867177;2.39803,48.865289;2.400191,48.861306;2.402353,48.858833;2.40491,48.85601;2.406077,48.852208;2.406292,48.850275;2.406262,48.847956;2.40283,48.847877;2.398146,48.848248?timestamps=1487143260;1487143320;1487143380;1487143440;1487143500;1487143560;1487143680;1487143740;1487143800;1487143860;1487143920;1487143980;1487144100;1487144220;1487144280;1487144340;1487144460;1487144460;1487144520;1487144580;1487144700;1487144760;1487144880;1487144940;1487145000;1487145060;1487145120;1487145180;1487145240;1487145300&radiuses=20;20;20;20;20;20;20;20;20;20;20;20;20;20;20;20;20;20;20;20;20;20;20;20;20;20;20;20;20;20&overview=full&geometries=geojson&generate_hints=false&annotations=true",{
	style:myStyle,
	middleware:function(data){
legs = data.matchings[0].legs;
for(var i in legs) {
nodes.push(legs[i].annotation.nodes);
}

for(i=0; i < nodes.length; i++){
for(j=0; j < nodes[i].length; j++) {
	loadurl += "n" + nodes[i][j] + ",";
}
}

document.getElementById("load_josm").innerHTML = '<a href="'+loadurl+'" target="hide">Load JOSM</a>';

		return data.matchings[0].geometry;
	}
});

geojsonLayer.addTo(map);
};



map.fitBounds(json.getBounds());
jj=json.getLayers()[0]._layers;

idx=Object.keys(jj)[0]

//debugger;
var decorator = L.polylineDecorator(jj[idx]._latlngs, 
{
    patterns: [
            {offset: 25, repeat: 50, symbol: L.Symbol.arrowHead({pixelSize: 15, pathOptions: 
{fillOpacity: 1, weight: 0}})}
        ]
}).addTo(map);

// ajout de l'échelle
L.control.scale().addTo(map);

</script>


</body>
</html>
